<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ComunidadCarta</title>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:white;
}
header{
  background:#020617;
  padding:15px;
  text-align:center;
}
button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#22c55e;
  color:black;
  font-weight:bold;
}
button:hover{opacity:.85}
input{
  padding:10px;
  width:90%;
  max-width:300px;
  border-radius:6px;
  border:none;
}
.section{
  display:none;
  padding:20px;
}
.card{
  background:#020617;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
}
</style>
</head>

<body>

<header>
<h1>ComunidadCarta</h1>
<p>Proyecto no oficial Â· Comunidad educativa</p>
</header>

<!-- LOGIN -->
<div id="login" class="section" style="display:block">
  <div class="card">
    <h2>Entrar</h2>
    <input id="userName" placeholder="Tu nombre">
    <br><br>
    <button onclick="entrar()">Entrar</button>
  </div>
</div>

<!-- MENU -->
<div id="menu" class="section">
  <button onclick="show('ranking')">ğŸ† Ranking</button>
  <button onclick="show('encuestas')">ğŸ“Š Encuestas</button>
  <button onclick="show('codigos')">ğŸŸï¸ CÃ³digos</button>
  <button onclick="show('anuncios')">ğŸ“¢ Anuncios</button>
</div>

<!-- RANKING -->
<div id="ranking" class="section">
  <h2>ğŸ† Ranking en tiempo real</h2>
  <div id="rankingList"></div>
</div>

<!-- ENCUESTAS -->
<div id="encuestas" class="section">
  <h2>ğŸ“Š Encuesta</h2>
  <div class="card">
    <p>Â¿Te gusta la comunidad?</p>
    <button onclick="vote('si')">SÃ­</button>
    <button onclick="vote('no')">No</button>
    <p id="votes"></p>
  </div>
</div>

<!-- CODIGOS -->
<div id="codigos" class="section">
  <h2>ğŸŸï¸ CÃ³digo</h2>
  <input id="codeInput" placeholder="Escribe cÃ³digo">
  <br><br>
  <button onclick="redeem()">Canjear</button>
  <p id="codeMsg"></p>
</div>

<!-- ANUNCIOS -->
<div id="anuncios" class="section">
  <h2>ğŸ“¢ Anuncios</h2>
  <div class="card">
    <p>Bienvenido a ComunidadCarta</p>
    <p>Proyecto pequeÃ±o Â· No afiliado a marcas</p>
  </div>
</div>

<script>
/* ===== BASE LOCAL (NO SE ROMPE) ===== */
let dbLocal = {
  users: JSON.parse(localStorage.getItem("users")||"{}"),
  votes: JSON.parse(localStorage.getItem("votes")||'{"si":0,"no":0}')
};

let currentUser = null;

/* ===== UTIL ===== */
function save(){
  localStorage.setItem("users", JSON.stringify(dbLocal.users));
  localStorage.setItem("votes", JSON.stringify(dbLocal.votes));
}

/* ===== LOGIN ===== */
function entrar(){
  const name = document.getElementById("userName").value.trim();
  if(!name) return alert("Escribe un nombre");

  currentUser = name;

  if(!dbLocal.users[name]){
    dbLocal.users[name] = {points:0};
  }

  save();
  document.getElementById("login").style.display="none";
  document.getElementById("menu").style.display="block";
  show("ranking");
  renderRanking();
}

/* ===== NAV ===== */
function show(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById("menu").style.display="block";
  document.getElementById(id).style.display="block";
}

/* ===== RANKING ===== */
function renderRanking(){
  const list = document.getElementById("rankingList");
  list.innerHTML="";
  Object.entries(dbLocal.users)
    .sort((a,b)=>b[1].points-a[1].points)
    .forEach(([name,data],i)=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerText=`#${i+1} ${name} - ${data.points} pts`;
      list.appendChild(div);
    });
}

/* ===== ENCUESTAS ===== */
function vote(type){
  dbLocal.votes[type]++;
  dbLocal.users[currentUser].points+=1;
  save();
  updateVotes();
  renderRanking();
}
function updateVotes(){
  document.getElementById("votes").innerText =
   `SÃ­: ${dbLocal.votes.si} | No: ${dbLocal.votes.no}`;
}
updateVotes();

/* ===== CODIGOS ===== */
function redeem(){
  const code = document.getElementById("codeInput").value;
  if(code==="CARTA10"){
    dbLocal.users[currentUser].points+=10;
    save();
    renderRanking();
    document.getElementById("codeMsg").innerText="CÃ³digo vÃ¡lido +10 pts";
  }else{
    document.getElementById("codeMsg").innerText="CÃ³digo invÃ¡lido";
  }
}
</script>

</body>
</html>




